generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Post {
  id          Int      @id @default(autoincrement())
  name        String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  createdById String
  createdBy   User     @relation(fields: [createdById], references: [id])

  @@index([name])
}

model Account {
  id                       String  @id @default(cuid())
  userId                   String
  type                     String
  provider                 String
  providerAccountId        String
  refresh_token            String?
  access_token             String?
  expires_at               Int?
  token_type               String?
  scope                    String?
  id_token                 String?
  session_state            String?
  refresh_token_expires_in Int?
  user                     User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model User {
  id                    String                  @id @default(cuid())
  name                  String?
  email                 String?                 @unique @db.VarChar(255)
  emailVerified         DateTime?
  image                 String?
  role                  UserRole                @default(CUSTOMER)
  phoneNumber           String?                 @db.VarChar(20)
  isActive              Boolean                 @default(true)
  createdAt             DateTime                @default(now())
  updatedAt             DateTime                @updatedAt
  password              String?
  districtCode          String?                 @db.VarChar(10)
  districtName          String?                 @db.VarChar(100)
  provinceCode          String?                 @db.VarChar(10)
  provinceName          String?                 @db.VarChar(100)
  regencyCode           String?                 @db.VarChar(10)
  regencyName           String?                 @db.VarChar(100)
  streetAddress         String?                 @db.VarChar(500)
  accounts              Account[]
  adminKosProfile       AdminKosProfile?
  customerProfile       CustomerProfile?
  posts                 Post[]
  approvedProperties    Property[]              @relation("PropertyApprover")
  ownedProperties       Property[]              @relation("PropertyOwner")
  PropertyStatusHistory PropertyStatusHistory[]
  receptionistProfile   ReceptionistProfile?
  sessions              Session[]

  @@index([email])
  @@index([role])
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model AdminKosProfile {
  id        String   @id @default(cuid())
  userId    String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model ReceptionistProfile {
  id        String    @id @default(cuid())
  userId    String    @unique
  startDate DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  shift     Shift?
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model CustomerProfile {
  id               String    @id @default(cuid())
  userId           String    @unique
  dateOfBirth      DateTime?
  gender           String?
  emergencyContact String?
  emergencyPhone   String?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  user             User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Property {
  id                    String                  @id @default(cuid())
  name                  String                  @db.VarChar(255)
  buildYear             Int
  propertyType          PropertyType
  description           String
  roomTypes             Json
  totalRooms            Int
  availableRooms        Int                     @default(0)
  provinceCode          String                  @db.VarChar(10)
  provinceName          String                  @db.VarChar(100)
  regencyCode           String                  @db.VarChar(10)
  regencyName           String                  @db.VarChar(100)
  districtCode          String                  @db.VarChar(10)
  districtName          String                  @db.VarChar(100)
  fullAddress           String                  @db.VarChar(500)
  latitude              Float
  longitude             Float
  facilities            Json
  rules                 Json
  status                PropertyStatus          @default(PENDING)
  ownerId               String
  createdAt             DateTime                @default(now())
  updatedAt             DateTime                @updatedAt
  approvedAt            DateTime?
  approvedBy            String?
  approver              User?                   @relation("PropertyApprover", fields: [approvedBy], references: [id])
  owner                 User                    @relation("PropertyOwner", fields: [ownerId], references: [id], onDelete: Cascade)
  images                PropertyImage[]
  PropertyStatusHistory PropertyStatusHistory[]
  rooms                 Room[]

  @@index([status])
  @@index([propertyType])
  @@index([ownerId])
  @@index([provinceCode, regencyCode, districtCode])
}

model PropertyImage {
  id         String        @id @default(cuid())
  propertyId String
  category   ImageCategory
  imageUrl   String        @db.VarChar(500)
  publicId   String?       @db.VarChar(255)
  caption    String?       @db.VarChar(255)
  sortOrder  Int           @default(0)
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
  property   Property      @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@index([propertyId, category])
}

model Room {
  id                String             @id @default(cuid())
  propertyId        String
  roomNumber        String             @db.VarChar(50)
  floor             Int
  roomType          String             @db.VarChar(100)
  description       String?
  size              String?            @db.VarChar(50)
  monthlyPrice      Decimal            @db.Decimal(10, 2)
  dailyPrice        Decimal?           @db.Decimal(10, 2)
  weeklyPrice       Decimal?           @db.Decimal(10, 2)
  quarterlyPrice    Decimal?           @db.Decimal(10, 2)
  yearlyPrice       Decimal?           @db.Decimal(10, 2)
  hasDeposit        Boolean            @default(false)
  facilities        Json
  isAvailable       Boolean            @default(true)
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  depositPercentage DepositPercentage?
  property          Property           @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  images            RoomImage[]

  @@unique([propertyId, roomNumber])
  @@index([propertyId])
  @@index([roomType])
  @@index([isAvailable])
}

model RoomImage {
  id        String        @id @default(cuid())
  roomId    String
  category  ImageCategory
  imageUrl  String        @db.VarChar(500)
  publicId  String?       @db.VarChar(255)
  caption   String?       @db.VarChar(255)
  sortOrder Int           @default(0)
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  room      Room          @relation(fields: [roomId], references: [id], onDelete: Cascade)

  @@index([roomId, category])
}

model PropertyStatusHistory {
  id         String          @id
  propertyId String
  fromStatus PropertyStatus?
  toStatus   PropertyStatus
  reason     String?
  changedBy  String
  createdAt  DateTime        @default(now())
  User       User            @relation(fields: [changedBy], references: [id])
  Property   Property        @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@index([changedBy])
  @@index([createdAt])
  @@index([propertyId])
  @@index([toStatus])
}

enum UserRole {
  SUPERADMIN
  ADMINKOS
  RECEPTIONIST
  CUSTOMER
}

enum Shift {
  MORNING
  EVENING
  NIGHT
}

enum PropertyType {
  MALE_ONLY
  FEMALE_ONLY
  MIXED
}

enum PropertyStatus {
  PENDING
  APPROVED
  REJECTED
  SUSPENDED
}

enum ImageCategory {
  BUILDING_PHOTOS
  SHARED_FACILITIES_PHOTOS
  FLOOR_PLAN_PHOTOS
  ROOM_PHOTOS
  BATHROOM_PHOTOS
}

enum DepositPercentage {
  TEN_PERCENT
  TWENTY_PERCENT
  THIRTY_PERCENT
  FORTY_PERCENT
  FIFTY_PERCENT
}
